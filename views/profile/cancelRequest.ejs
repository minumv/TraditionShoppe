<%- include('../layout/profileHeader') %>

    <div class="ord-box">
        <div class="cancel-det">
            <div class="cancel-head">
                Easy Cancellation
            </div>
            <form id="cancelForm">
            <div class="cancel-body d-block">
                <div>
                    <div class="dropdown mx-3">
                        <select id="cancelreason" class="form-control">
                          <option value="No Type">Select Reason</option>
                          <option value="I want to change delivery address">I want to change delivery address</option>
                          <option value="I want to change payment option">I want to change payment option</option>
                          <option value="I want to change contact details">I want to change contact details</option>
                          <option value="I was hopping for a short delivery time">I was hopping for a short delivery time</option>
                          <option value="Price of the product has now decreased">Price of the product has now decreased</option>
                          <option value="I am worried about the ratings and reviews">I am worried about the ratings and reviews</option>
                          <option value="My reasons are not listed here">My reasons are not listed here</option>                            
                        </select>
                    </div> 
                </div>
                
                <div class="d-flex justify-content-end">
                    <button id="cancelbut" type="button" class="use-but ord-but bg-white text-dark"  onclick="handleCancel('<%=orderid%>','<%=pdtid%>')">Continue</button>
                </div>
            </div>
        </div>
        <div class="ord-det">

        </div>

    </div>

</form>
  </div>

  <script>

     // request for cancel   onclick="requestCancel(orderid)"

     function handleCancel(orderid,pdtid) {
    alert("button clicked");
    
    // Get selected values from dropdowns
    const reason = $('#cancelreason').val();
    console.log("reason:" + reason);

    // Your fetch code or any other code to handle the button click
    fetch('/getReturnReason', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            cancel_reason: reason
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        // Handle success response
        console.log('Server response:', data);
        requestCancel(orderid,pdtid);
    })
    .catch(error => {
        console.error('Fetch Error:', error);
    });
}

     function requestCancel(ordrid,pdtid){
        fetch(`/cancelRequest/${ordrid}/${pdtid}`,{
            method:'post',
            headers : {
                'Content-Type' : 'application/json'
            }            
        })
        .then(res=>res.json())
        .then(data=>{
            if( data.success ){
                location.href = '/getOrder'
            } else {
                location.href = '/getOrder'
            }
        })

    }
  </script>

  <%- include('../layout/userFooter') %>